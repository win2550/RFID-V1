// ‡πÇ‡∏´‡∏•‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡πÄ‡∏ä‡πà‡∏ô "2025-06-04")
const todayStr = new Date().toISOString().split("T")[0];

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°
let todayData = JSON.parse(localStorage.getItem('todayData')) || [];
let historicalData = JSON.parse(localStorage.getItem('historicalData')) || {};

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
const lastUpdatedDate = localStorage.getItem("lastUpdatedDate");

// ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏° ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà
if (lastUpdatedDate && lastUpdatedDate !== todayStr) {
  // ‡∏¢‡πâ‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô
  if (todayData.length > 0) {
    historicalData[lastUpdatedDate] = (historicalData[lastUpdatedDate] || []).concat(todayData);
  }

  // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
  todayData = [];
  localStorage.setItem("todayData", JSON.stringify(todayData));
  localStorage.setItem("historicalData", JSON.stringify(historicalData));
}

// ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà
localStorage.setItem("lastUpdatedDate", todayStr);


//‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
//‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
//‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
//‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
//‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
//‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
//‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
//‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
//‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
//‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
//‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
//‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
//‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
//‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
//‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
//‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
//‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
//‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô //‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô

let classData = {
    m11: [],
    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÉ‡∏™‡πà array ‡πÄ‡∏õ‡∏•‡πà‡∏≤‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô)
    m12: [], 
    m13: [], 
    m14: [
        { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 1', id: '100000' },
        { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 2', id: '100000' },
        { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 3', id: '100000' },
        { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 4', id: '100000' }
    ], 
     m15: [], m16: [], m17: [], m18: [], m19: [], m110: [], m111: [], m112: [],
     m21: [], m22: [], m23: [], m24: [], m25: [], m26: [], m27: [], m28: [], m29: [], m210: [], m211: [], m212: [],
     m31: [], m32: [], m33: [], m34: [], m35: [], m36: [], m37: [], m38: [], m39: [], m310: [], m311: [], m312: [],
     m41: [], m42: [], m43: [], m44: [], m45: [], m46: [], m47: [], m48: [], m49: [], m410: [], m411: [], m412: [],
     m51: [], m52: [], m53: [], m54: [], m55: [], m56: [], m57: [], m58: [], m59: [], m510: [], m511: [], m512: [],
     m61: [
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 1', id: '0524341830' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 2', id: '0524291866' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 3', id: '0524278452' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 4', id: '0524265572' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 5', id: '0524312563' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 6', id: '0524322839' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 7', id: '0524296314' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 8', id: '0524286774' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 9', id: '0524323709' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 10', id: '0524347693' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 11', id: '0793386100' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 12', id: '0793468549' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 13', id: '0793358550' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 14', id: '0793443813' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 15', id: '0524269358' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 16', id: '0524332702' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 17', id: '0524308439' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 18', id: '0524259145' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 19', id: '0524337019' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 20', id: '1339676489' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 21', id: '0524310646' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 22', id: '0524338534' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 23', id: '0524315228' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 24', id: '0524285822' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 25', id: '0524297817' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 26', id: '0524301949' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 27', id: '0524324410' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 28', id: '0524351878' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 29', id: '0524320947' },
      { name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 30', id: '0524307221' }
     ], 
     m62: [], m63: [], m64: [], m65: [], m66: [], m67: [], m68: [], m69: [], m610: [], m611: [], m612: []
};


//‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
//‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
//‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
//‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
//‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
//‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
//‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
//‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
//‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
//‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
//‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
//‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
//‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
//‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
//‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô  //‡∏´‡∏ô‡πâ‡∏≤login ‡∏≠‡∏µ‡πÄ‡∏°‡∏•-‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô


// User authentication data
const users = {
  'admin@gmail.com': { password: 'admin_123', role: 'admin' },
  'shop1@gmail.com': { password: 'cellshop_1', role: 'shop', shopId: 1 },
  'shop2@gmail.com': { password: 'cellshop_2', role: 'shop', shopId: 2 },
  'shop3@gmail.com': { password: 'cellshop_3', role: 'shop', shopId: 3 }
  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
};


let currentUserRole = null;
let currentShopId = null;

document.addEventListener('DOMContentLoaded', () => {
  showPage('login-page');

  // Add event listener for Enter key on login page
  document.getElementById('login-email').addEventListener('keypress', function(event) {
    if (event.key === 'Enter') {
      event.preventDefault(); // Prevent default form submission
      document.getElementById('login-password').focus(); // Move focus to password
    }
  });
  document.getElementById('login-password').addEventListener('keypress', function(event) {
    if (event.key === 'Enter') {
      event.preventDefault(); // Prevent default form submission
      handleLogin();
    }
  });

  // Add event listeners for Enter key for shop forms
  for (let i = 1; i <= 3; i++) { // Loop for use1, use2, use3 forms
      const formId = `use${i}-form`;
      const idInputId = `use${i}-id`;

      document.getElementById(idInputId).addEventListener('keypress', function(event) {
          if (event.key === 'Enter') {
              event.preventDefault(); // Prevent default form submission
              handleUseSubmit(event, i); // Pass shop number
          }
      });
      // Also handle form submission when the submit button is clicked (original behavior)
      document.getElementById(formId).addEventListener('submit', function(event) {
          event.preventDefault();
          handleUseSubmit(event, i); // Pass shop number
      });
  }

  // Initialize the daily clear schedule
  scheduleDailyClear();
  // Clean up old historical data on load
  cleanOldHistoricalData();
});

// --- Date and Time Utilities ---
function formatDateTime(date) {
    const options = {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: false // 24-hour format
    };
    return date.toLocaleDateString('th-TH', options);
}

function formatDate(date) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
}

function updateCurrentDateTime() {
    const datetimeElement = document.getElementById('current-datetime');
    if (datetimeElement) {
        datetimeElement.textContent = formatDateTime(new Date());
    }
}

setInterval(updateCurrentDateTime, 1000); // Update every second

function scheduleDailyClear() {
    const now = new Date();
    const clearTime = new Date(now);
    clearTime.setHours(21, 0, 0, 0); // ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô 21:00:00

    let delay;
    if (now.getTime() < clearTime.getTime()) {
        // ‡∏ñ‡πâ‡∏≤‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á 21:00 ‡∏ô. ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
        delay = clearTime.getTime() - now.getTime();
    } else {
        // ‡∏ñ‡πâ‡∏≤‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏¥‡∏ô 21:00 ‡∏ô. ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ
        clearTime.setDate(clearTime.getDate() + 1);
        delay = clearTime.getTime() - now.getTime();
    }

    console.log(`Scheduled daily data clear at ${clearTime.toLocaleTimeString('th-TH')} for next trigger in ${delay / 1000 / 60} minutes.`);
    setTimeout(dailyClearData, delay);
}

function dailyClearData() {
    console.log('Performing daily data clear...');
    const now = new Date();
    const todayKey = formatDate(now); // YYYY-MM-DD

    if (todayData.length > 0) {
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô)
        // ‡∏ñ‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô historicalData ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß
        if (!historicalData[todayKey]) {
            historicalData[todayKey] = [];
        }
        // ‡∏¢‡πâ‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å todayData ‡πÑ‡∏õ‡∏¢‡∏±‡∏á historicalData ‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
        historicalData[todayKey] = historicalData[todayKey].concat(todayData);
        localStorage.setItem('historicalData', JSON.stringify(historicalData));

        // ‡∏•‡πâ‡∏≤‡∏á todayData
        todayData = [];
        localStorage.setItem('todayData', JSON.stringify(todayData));
        console.log(`todayData cleared and moved to historicalData for ${todayKey}.`);
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏Ç‡∏≠‡∏á Admin ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏ñ‡πâ‡∏≤ Admin ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏π‡∏≠‡∏¢‡∏π‡πà)
        if (currentUserRole === 'admin') {
            renderTodayTable(); // ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤
            for (const className in classData) {
                updateClassTable(className);
            }
            updateSummaryAllView(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á
        }
    } else {
        console.log('No data in todayData to clear.');
    }

    cleanOldHistoricalData(); // ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏î‡πâ‡∏ß‡∏¢
    scheduleDailyClear(); // ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
}

// --- Data Management and Scheduling ---

const todayDate = new Date().toISOString().split('T')[0];
const lastSavedDate = localStorage.getItem("lastSavedDate");

if (lastSavedDate !== todayDate) {
  todayData = [];
  localStorage.setItem("todayData", JSON.stringify(todayData));
  localStorage.setItem("lastSavedDate", todayDate);
}

function cleanOldHistoricalData() {
    console.log('Cleaning old historical data...');
    const now = new Date();
    const sevenDaysAgo = new Date(now);
    sevenDaysAgo.setDate(now.getDate() - 7); // 7 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß

    let changed = false;
    for (const dateKey in historicalData) {
        const historyDate = new Date(dateKey); // ‡πÅ‡∏õ‡∏•‡∏á string dateKey ‡πÄ‡∏õ‡πá‡∏ô Date object
        if (historyDate.getTime() < sevenDaysAgo.getTime()) {
            delete historicalData[dateKey];
            changed = true;
            console.log(`Deleted historical data for ${dateKey} (older than 7 days).`);
        }
    }
    if (changed) {
        localStorage.setItem('historicalData', JSON.stringify(historicalData));
        // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á ‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏Ç‡∏≠‡∏á Admin ‡∏ñ‡πâ‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á
        if (currentUserRole === 'admin' && (document.getElementById('view-summary-all').style.display === 'block' || document.querySelector('.summary-class-view').style.display === 'block')) {
             updateSummaryAllView();
             // ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å updateClassTableForSummary ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏¢‡∏π‡πà
        }
    } else {
        console.log('No old historical data to clean.');
    }
}


function showPage(pageId) {
  document.querySelectorAll('.page').forEach(page => {
    page.classList.remove('active');
    page.style.display = 'none';
  });
  document.getElementById(pageId).classList.add('active');
  document.getElementById(pageId).style.display = 'block';

  // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ use-page
  if (pageId === 'use-page') {
      // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ use-page ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
      document.querySelectorAll('.use-view').forEach(view => view.style.display = 'none');
      document.querySelectorAll('.shop-form').forEach(form => form.style.display = 'none');

      if (currentUserRole === 'shop') {
          // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
          const targetUseView = document.getElementById(`view-use${currentShopId}-shop`);
          if (targetUseView) {
              targetUseView.style.display = 'block';
              const currentShopForm = document.getElementById(`use${currentShopId}-form`);
              if (currentShopForm) {
                  currentShopForm.style.display = 'flex';
              }
          }
          updateCurrentDateTime(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ use-page
      }
  }
}

function handleLogin() {
  const email = document.getElementById('login-email').value.trim();
  const password = document.getElementById('login-password').value.trim();
  const errorDisplay = document.getElementById('login-error');

  if (users[email] && users[email].password === password) {
    currentUserRole = users[email].role;
    currentShopId = users[email].shopId;
    errorDisplay.style.display = 'none';

    if (currentUserRole === 'admin') {
      showPage('main-app-page');
      switchView('home-main'); // Go to home page of admin
      renderTodayTable();
      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
      for (const className in classData) {
        updateClassTable(className);
      }
      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ
      updateSummaryAllView();
    } else if (currentUserRole === 'shop') {
      showPage('use-page');
      displayShopPageForShopUser(currentShopId); // Show the specific shop's use page
    }
  } else {
    errorDisplay.textContent = '‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
    errorDisplay.style.display = 'block';
  }
}

function logout() {
  currentUserRole = null;
  currentShopId = null;
  showPage('login-page');
  document.getElementById('login-email').value = '';
  document.getElementById('login-password').value = '';
  // ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏ô‡∏π dropdown ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å logout
  const adminMenu = document.getElementById('adminMenuDropdown');
  const shopMenu = document.getElementById('shopMenuDropdown');
  if (adminMenu) adminMenu.classList.remove('show');
  if (shopMenu) shopMenu.classList.remove('show');
  // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏°‡∏ô‡∏π
  const adminMenuBtn = document.querySelector('.admin-menu-btn');
  const shopMenuBtn = document.querySelector('.shop-menu-btn');
  if (adminMenuBtn) {
      adminMenuBtn.classList.remove('toggle');
      adminMenuBtn.querySelector('.menu-icon').textContent = "‚ò∞";
  }
  if (shopMenuBtn) {
      shopMenuBtn.classList.remove('toggle');
      shopMenuBtn.querySelector('.menu-icon').textContent = "‚ò∞";
  }
}

// ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Admin: ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ô contentArea ‡∏Ç‡∏≠‡∏á main-app-page
function showShopAdminTable(shopNumber) {
    if (currentUserRole === 'admin') {
        // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å view ‡πÉ‡∏ô contentArea ‡∏Å‡πà‡∏≠‡∏ô
        document.querySelectorAll('#contentArea .view').forEach(v => v.style.display = 'none');
        // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ view ‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Admin
        const targetShopAdminView = document.getElementById(`view-shop${shopNumber}-admin`);
        if (targetShopAdminView) {
            targetShopAdminView.style.display = 'block';
        }
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏±‡πâ‡∏ô
        updateShopTable(shopNumber, 'admin'); // ‡∏™‡πà‡∏á role ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô Admin
    } else {
        alert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•');
    }
}

// ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤: ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ use-page
function displayShopPageForShopUser(shopId) {
  document.getElementById('use-page-header').textContent = `‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ${shopId}`;
  
  // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å view ‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ use-page ‡∏Å‡πà‡∏≠‡∏ô
  document.querySelectorAll('.use-view').forEach(view => view.style.display = 'none');
  document.querySelectorAll('.shop-form').forEach(form => form.style.display = 'none');

  // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ view ‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
  const targetUseView = document.getElementById(`view-use${shopId}-shop`);
  if (targetUseView) {
      targetUseView.style.display = 'block';
      // ‡πÅ‡∏™‡∏î‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
      const currentShopForm = document.getElementById(`use${shopId}-form`);
      if (currentShopForm) {
          currentShopForm.style.display = 'flex';
      }
  }
  
  updateShopTable(shopId, 'shop'); // ‡∏™‡πà‡∏á role ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤
  // Focus on the first input field of the active use form
  const idInput = document.getElementById(`use${shopId}-id`);
  idInput.focus(); // Focus on ID input
}


function switchView(view) {
    if (currentUserRole === 'admin') {
        document.querySelectorAll('#contentArea .view').forEach(v => v.style.display = 'none');
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô view ‡∏Ç‡∏≠‡∏á summary-class ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        if (view.startsWith('summary-m')) {
            const className = view.replace('summary-', ''); // ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠ class ‡πÄ‡∏ä‡πà‡∏ô m11
            const targetView = document.getElementById(`view-${view}`);
            if (targetView) {
                targetView.style.display = 'block';
                updateClassTableForSummary(className); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏±‡πâ‡∏ô‡πÜ
            }
        } else if (view === 'summary-all') {
             const targetView = document.getElementById(`view-${view}`);
            if (targetView) {
                targetView.style.display = 'block';
                updateSummaryAllView(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            }
        }
        else { // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö view ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÄ‡∏ä‡πà‡∏ô home-main, today, m11, shop1-admin
            const targetView = document.getElementById(`view-${view}`);
            if (targetView) {
                targetView.style.display = 'block';
            }

            if (view.startsWith('m') && !view.startsWith('summary-m')) { // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô mXX ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà summary
                updateClassTable(view);
            }
            if (view === 'today') {
                renderTodayTable();
            }
        }
    } else if (currentUserRole === 'shop') {
        alert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ. ‡πÇ‡∏õ‡∏£‡∏î‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•.');
    }
}

// ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á ‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ß‡∏•‡∏≤ 07:00 ‡∏ô. ‡∏ñ‡∏∂‡∏á 16:00 ‡∏ô. ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
// ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á ‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ß‡∏•‡∏≤ 07:00 ‡∏ô. ‡∏ñ‡∏∂‡∏á 16:00 ‡∏ô. ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
// ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á ‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ß‡∏•‡∏≤ 07:00 ‡∏ô. ‡∏ñ‡∏∂‡∏á 16:00 ‡∏ô. ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
// ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á ‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ß‡∏•‡∏≤ 07:00 ‡∏ô. ‡∏ñ‡∏∂‡∏á 16:00 ‡∏ô. ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
// ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á ‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ß‡∏•‡∏≤ 07:00 ‡∏ô. ‡∏ñ‡∏∂‡∏á 16:00 ‡∏ô. ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
// ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á ‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ß‡∏•‡∏≤ 07:00 ‡∏ô. ‡∏ñ‡∏∂‡∏á 16:00 ‡∏ô. ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
// ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á ‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ß‡∏•‡∏≤ 07:00 ‡∏ô. ‡∏ñ‡∏∂‡∏á 16:00 ‡∏ô. ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
// ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á ‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ß‡∏•‡∏≤ 07:00 ‡∏ô. ‡∏ñ‡∏∂‡∏á 16:00 ‡∏ô. ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
// ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á ‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ß‡∏•‡∏≤ 07:00 ‡∏ô. ‡∏ñ‡∏∂‡∏á 16:00 ‡∏ô. ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
// ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á ‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ß‡∏•‡∏≤ 07:00 ‡∏ô. ‡∏ñ‡∏∂‡∏á 16:00 ‡∏ô. ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
// ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á ‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ß‡∏•‡∏≤ 07:00 ‡∏ô. ‡∏ñ‡∏∂‡∏á 16:00 ‡∏ô. ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
// ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á ‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ß‡∏•‡∏≤ 07:00 ‡∏ô. ‡∏ñ‡∏∂‡∏á 16:00 ‡∏ô. ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
// ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á ‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ß‡∏•‡∏≤ 07:00 ‡∏ô. ‡∏ñ‡∏∂‡∏á 16:00 ‡∏ô. ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
// ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á ‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ß‡∏•‡∏≤ 07:00 ‡∏ô. ‡∏ñ‡∏∂‡∏á 16:00 ‡∏ô. ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
// ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á ‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ß‡∏•‡∏≤ 07:00 ‡∏ô. ‡∏ñ‡∏∂‡∏á 16:00 ‡∏ô. ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
// ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á ‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ß‡∏•‡∏≤ 07:00 ‡∏ô. ‡∏ñ‡∏∂‡∏á 16:00 ‡∏ô. ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
// ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á ‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ß‡∏•‡∏≤ 07:00 ‡∏ô. ‡∏ñ‡∏∂‡∏á 16:00 ‡∏ô. ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô


async function handleUseSubmit(e, shopNumber) {
    e.preventDefault(); // Ensure default form submission is prevented for both click and Enter
    const shopName = `‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ${shopNumber}`;
    const idInput = document.getElementById(`use${shopNumber}-id`);
    const id = idInput.value.trim();

    const now = new Date();
    const currentHour = now.getHours();
    
    // --- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (7:00 - 16:00) ---
    if (currentHour < 7 || currentHour >= 20) {
        alert('‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ß‡∏•‡∏≤ 07:00 ‡∏ô. ‡∏ñ‡∏∂‡∏á 16:00 ‡∏ô. ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
        idInput.value = ''; // Clear input if outside allowed time
        idInput.focus();
        return;
    }
    // --- ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ ---


    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const time = `${hours}:${minutes}`; // ‡∏î‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
    const dateRecorded = formatDate(now); // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å YYYY-MM-DD

    if (!id) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å ‡∏£‡∏´‡∏±‡∏™ ID ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô');
        return;
    }

    // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏≤‡∏Å classData (‡∏Ñ‡∏ß‡∏£‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏´‡∏≤‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏ä‡∏±‡πâ‡∏ô)
    let student = null;
    let studentClass = ''; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
    for (const className in classData) {
        student = classData[className].find(s => s.id === id);
        if (student) {
            studentClass = className; // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
            break;
        }
    }
    
    let name = student ? student.name : '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô';

    if (!student) {
         alert(`‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™ ID: ${id} ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•`);
         idInput.value = ''; // Clear input if not found
         idInput.focus();
         return; // ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö ID
    }

    const existingEntry = todayData.find(d => d.id === id);

    if (existingEntry) {
        if (existingEntry.shop === shopName) {
            alert(`ID ${id} ‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÉ‡∏ô‡∏£‡πâ‡∏≤‡∏ô ${shopName} ‡πÅ‡∏•‡πâ‡∏ß`);
        } else {
            alert(`ID ${id} ‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÉ‡∏ô‡∏£‡πâ‡∏≤‡∏ô ${existingEntry.shop} ‡πÅ‡∏•‡πâ‡∏ß`);
        }
        idInput.value = ''; // Clear input if already used today
        idInput.focus();
        return;
    }

    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (dateRecorded)
    todayData.push({ name, id, shop: shopName, time, dateRecorded, class: studentClass });
    localStorage.setItem('todayData', JSON.stringify(todayData));

    idInput.value = '';
    idInput.focus(); // Focus back to the ID input after submission
    
    updateShopTable(shopNumber, 'shop'); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤
    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    renderTodayTable();
    for (const className in classData) {
        updateClassTable(className);
    }
    updateSummaryAllView(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
}

function renderTodayTable() {
  const tbody = document.getElementById('today-body');
  if (!tbody) return;
  tbody.innerHTML = '';
  if (todayData.length === 0) return;

  todayData.forEach((d, i) => {
    const row = `<tr><td>${i + 1}</td><td>${d.name}</td><td>${d.id}</td><td>${d.shop}</td><td>${d.time}</td></tr>`;
    tbody.innerHTML += row;
  });
}

function updateClassTable(className) {
  const tbody = document.getElementById(`${className}-body`);
  if (!tbody) return;
  tbody.innerHTML = '';
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö class ‡∏ô‡∏±‡πâ‡∏ô‡πÜ ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà class ‡∏ß‡πà‡∏≤‡∏á
  if (!classData[className] || classData[className].length === 0) {
    tbody.innerHTML = '<tr><td colspan="6">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏µ‡πâ</td></tr>';
    return;
  }

  classData[className].forEach((d, i) => {
    const found = todayData.find(t => t.id === d.id);
    const use = found ? '‚úîÔ∏è' : '‚ùå';
    const shop = found ? found.shop : '-';
    const time = found ? found.time : '-';
    const row = `<tr><td>${i + 1}</td><td>${d.name}</td><td>${d.id}</td><td>${use}</td><td>${shop}</td><td>${time}</td></tr>`;
    tbody.innerHTML += row;
  });
}

function updateShopTable(shopNumber, role) {
  let tbodyId;
  if (role === 'admin') {
      tbodyId = `shop${shopNumber}-admin-body`; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á Admin
  } else { // role === 'shop'
      tbodyId = `use${shopNumber}-body`; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏≠‡∏á
  }
  
  const tbody = document.getElementById(tbodyId);
  if (!tbody) return;
  tbody.innerHTML = '';

  const filtered = todayData.filter(d => d.shop === `‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ${shopNumber}`);

  if (filtered.length === 0) return;

  filtered.forEach((d, i) => {
    const row = `<tr>
      <td>${i + 1}</td>
      <td>${d.name}</td>
      <td>${d.id}</td>
      <td>${d.shop}</td>
      <td>${d.time}</td>
    </tr>`;
    tbody.innerHTML += row;
  });
}

// üîÅ ‡∏ß‡∏≤‡∏á‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 593 ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏õ
function updateClassTableForSummary(viewId) {
  const tbody = document.getElementById(`summary-${viewId}-body`);
  if (!tbody || !classData[viewId]) return;

  tbody.innerHTML = '';
  const currentClassData = classData[viewId];
  let rowNumberMap = {};

  // ‚úÖ ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡πÉ‡∏´‡∏°‡πà ‚Üí ‡πÄ‡∏Å‡πà‡∏≤)
  const today = new Date();
  const datesToShow = [];
  for (let i = 0; i < 7; i++) {
    const d = new Date(today);
    d.setDate(today.getDate() - i);
    datesToShow.push(d.toISOString().split('T')[0]);
  }

  // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° sort ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô
  datesToShow.sort((a, b) => new Date(b) - new Date(a)); // ‡πÉ‡∏´‡∏°‡πà ‚Üí ‡πÄ‡∏Å‡πà‡∏≤

  // ‚úÖ ‡∏£‡∏ß‡∏° historical + todayData ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô object
  const recordMap = {}; // { date: { id: record } }

  for (const date in historicalData) {
    if (!datesToShow.includes(date)) continue;
    historicalData[date].forEach(r => {
      if (!recordMap[date]) recordMap[date] = {};
      recordMap[date][r.id] = r;
    });
  }

  const todayStr = today.toISOString().split('T')[0];
  todayData.forEach(td => {
    if (!recordMap[todayStr]) recordMap[todayStr] = {};
    recordMap[todayStr][td.id] = {
      id: td.id,
      shop: td.shop,
      time: td.time,
      class: viewId,
      dateRecorded: todayStr, // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á todayData
    };
  });

  currentClassData.forEach((student, index) => {
    let useCount = 0;

    // ‚úÖ ‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡πÉ‡∏´‡∏°‡πà ‚Üí ‡πÄ‡∏Å‡πà‡∏≤
    datesToShow.forEach(date => {
      const record = recordMap[date]?.[student.id];
      const use = record ? '‚úîÔ∏è' : '‚ùå';
      const shop = record?.shop || '-';
      const time = record?.time || '-';

      useCount++;
      const number = `${index + 1}.${useCount}`;

      const row = `<tr>
        <td>${number}</td>
        <td>${student.name}</td>
        <td>${student.id}</td>
        <td>${use}</td>
        <td>${shop}</td>
        <td>${time}</td>
        <td>${date}</td>
      </tr>`;
      tbody.innerHTML += row;
    });
  });
}


  

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
function updateSummaryAllView() {
  const summaryAllContentDiv = document.getElementById('summary-all-content');
  if (!summaryAllContentDiv) return;
  summaryAllContentDiv.innerHTML = ''; // Clear previous content

  for (let i = 1; i <= 6; i++) {
      for (let j = 1; j <= 12; j++) {
          const className = `m${i}${j}`;
          const classLabel = `‡∏°.${i}/${j}`;
          
          // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡∏±‡πâ‡∏ô
          const h4 = document.createElement('h4');
          h4.textContent = classLabel;
          summaryAllContentDiv.appendChild(h4);

          const table = document.createElement('table');
          table.innerHTML = `
              <thead>
                  <tr><th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>ID</th><th>‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ</th><th>‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</th></tr>
              </thead>
              <tbody id="summary-${className}-body-all-view"></tbody>
          `;
          summaryAllContentDiv.appendChild(table);

          const tbody = document.getElementById(`summary-${className}-body-all-view`);
          if (!tbody || !classData[className]) continue;
          tbody.innerHTML = '<tr><td colspan="7">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏µ‡πâ</td></tr>'; // Default message, colspan 7
          
          if (classData[className].length > 0) {
            let currentClassData = classData[className];
            // Sort by name for consistent display
            currentClassData.sort((a, b) => a.name.localeCompare(b.name, 'th'));

            tbody.innerHTML = ''; // Clear default message if data exists

            // ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏≤‡∏Å historicalData
            let combinedHistoricalData = [];
            for (const dateKey in historicalData) {
                const dataForDate = historicalData[dateKey].filter(d => d.class === className);
                combinedHistoricalData = combinedHistoricalData.concat(dataForDate);
            }

            currentClassData.forEach((d, k) => {
                // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å todayData ‡∏Å‡πà‡∏≠‡∏ô
                let found = todayData.find(t => t.id === d.id);
                let use = '‚ùå';
                let shop = '-';
                let time = '-';
                let dateRecorded = '-';

                if (found) {
                    use = '‚úîÔ∏è';
                    shop = found.shop;
                    time = found.time;
                    dateRecorded = formatDate(new Date()); // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                } else {
                    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ô todayData ‡πÉ‡∏´‡πâ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô historicalData
                    const foundInHistory = combinedHistoricalData.find(t => t.id === d.id);
                    if (foundInHistory) {
                        use = '‚úîÔ∏è';
                        shop = foundInHistory.shop;
                        time = foundInHistory.time;
                        dateRecorded = foundInHistory.dateRecorded; // ‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏≤‡∏Å historicalData
                    }
                }
                const row = `<tr><td>${k + 1}</td><td>${d.name}</td><td>${d.id}</td><td>${use}</td><td>${shop}</td><td>${time}</td><td>${dateRecorded}</td></tr>`;
                tbody.innerHTML += row;
            });
          }
      }
  }
}

//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á   ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á  ‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á   ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á  ‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á   ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á  ‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á   ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á  ‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á   ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á  ‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á   ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á  ‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á   ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á  ‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á   ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á  ‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á   ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á  ‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á   ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á  ‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á   ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á  ‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á   ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á  ‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á   ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á  ‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á   ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á  ‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á


function downloadExcel(view) {
  let wb = XLSX.utils.book_new();
  let ws;

  function makeSafeSheetName(name) {
    return name.replace(/[\\/:?*\[\]]/g, '-');
  }

  switch (view) {
    case 'today':
      if (todayData.length > 0) {
        ws = XLSX.utils.json_to_sheet(todayData.map((d, i) => ({
          ‡∏•‡∏≥‡∏î‡∏±‡∏ö: i + 1,
          ‡∏ä‡∏∑‡πà‡∏≠: d.name,
          ID: d.id,
          ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤: d.shop,
          ‡πÄ‡∏ß‡∏•‡∏≤: d.time
        })));
        XLSX.utils.book_append_sheet(wb, ws, '‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ');
      }
      break;

    case 'm11': case 'm12': case 'm13': case 'm14': case 'm15': case 'm16': case 'm17': case 'm18': case 'm19': case 'm110': case 'm111': case 'm112':
    case 'm21': case 'm22': case 'm23': case 'm24': case 'm25': case 'm26': case 'm27': case 'm28': case 'm29': case 'm210': case 'm211': case 'm212':
    case 'm31': case 'm32': case 'm33': case 'm34': case 'm35': case 'm36': case 'm37': case 'm38': case 'm39': case 'm310': case 'm311': case 'm312':
    case 'm41': case 'm42': case 'm43': case 'm44': case 'm45': case 'm46': case 'm47': case 'm48': case 'm49': case 'm410': case 'm411': case 'm412':
    case 'm51': case 'm52': case 'm53': case 'm54': case 'm55': case 'm56': case 'm57': case 'm58': case 'm59': case 'm510': case 'm511': case 'm512':
    case 'm61': case 'm62': case 'm63': case 'm64': case 'm65': case 'm66': case 'm67': case 'm68': case 'm69': case 'm610': case 'm611': case 'm612':
      let classNameRaw = view;
      if (classData[classNameRaw]) {
        const data = classData[classNameRaw].map((d, i) => {
          const found = todayData.find(t => t.id === d.id);
          return {
            ‡∏•‡∏≥‡∏î‡∏±‡∏ö: i + 1,
            ‡∏ä‡∏∑‡πà‡∏≠: d.name,
            ID: d.id,
            ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ: found ? '‚úîÔ∏è' : '‚ùå',
            ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤: found?.shop || '-',
            ‡πÄ‡∏ß‡∏•‡∏≤: found?.time || '-'
          };
        });
        const rawSheetName = `‡∏°.${classNameRaw.slice(1,2)}/${classNameRaw.slice(2)}`;
        const sheetName = makeSafeSheetName(rawSheetName);
        ws = XLSX.utils.json_to_sheet(data);
        XLSX.utils.book_append_sheet(wb, ws, sheetName);
      }
      break;

      case 'summary-m11': case 'summary-m12': case 'summary-m13': case 'summary-m14': case 'summary-m15': case 'summary-m16':
        case 'summary-m17': case 'summary-m18': case 'summary-m19': case 'summary-m110': case 'summary-m111': case 'summary-m112':
        case 'summary-m21': case 'summary-m22': case 'summary-m23': case 'summary-m24': case 'summary-m25': case 'summary-m26':
        case 'summary-m27': case 'summary-m28': case 'summary-m29': case 'summary-m210': case 'summary-m211': case 'summary-m212':
        case 'summary-m31': case 'summary-m32': case 'summary-m33': case 'summary-m34': case 'summary-m35': case 'summary-m36':
        case 'summary-m37': case 'summary-m38': case 'summary-m39': case 'summary-m310': case 'summary-m311': case 'summary-m312':
        case 'summary-m41': case 'summary-m42': case 'summary-m43': case 'summary-m44': case 'summary-m45': case 'summary-m46':
        case 'summary-m47': case 'summary-m48': case 'summary-m49': case 'summary-m410': case 'summary-m411': case 'summary-m412':
        case 'summary-m51': case 'summary-m52': case 'summary-m53': case 'summary-m54': case 'summary-m55': case 'summary-m56':
        case 'summary-m57': case 'summary-m58': case 'summary-m59': case 'summary-m510': case 'summary-m511': case 'summary-m512':
        case 'summary-m61': case 'summary-m62': case 'summary-m63': case 'summary-m64': case 'summary-m65': case 'summary-m66':
        case 'summary-m67': case 'summary-m68': case 'summary-m69': case 'summary-m610': case 'summary-m611': case 'summary-m612': {
          let summaryClassName = view.replace('summary-', '');
          if (classData[summaryClassName]) {
            let combinedHistoricalDataForClass = [];
            for (const dateKey in historicalData) {
              const dataForDate = historicalData[dateKey]
                .filter(d => d.class === summaryClassName)
                .map(d => ({ ...d, dateRecorded: d.dateRecorded || dateKey }));
              combinedHistoricalDataForClass = combinedHistoricalDataForClass.concat(dataForDate);
            }
    
            const data = classData[summaryClassName].map((d, i) => {
              let use = '‚ùå', shop = '-', time = '-', dateRecorded = '-';
              const foundToday = todayData.find(t => t.id === d.id);
              if (foundToday) {
                use = '‚úîÔ∏è';
                shop = foundToday.shop;
                time = foundToday.time;
                dateRecorded = formatDate(new Date());
              } else {
                const foundInHistory = combinedHistoricalDataForClass.find(t => t.id === d.id);
                if (foundInHistory) {
                  use = '‚úîÔ∏è';
                  shop = foundInHistory.shop;
                  time = foundInHistory.time;
                  dateRecorded = foundInHistory.dateRecorded;
                }
              }
              return {
                ‡∏•‡∏≥‡∏î‡∏±‡∏ö: i + 1,
                ‡∏ä‡∏∑‡πà‡∏≠: d.name,
                ID: d.id,
                ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ: use,
                ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤: shop,
                ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: time,
                ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: dateRecorded
              };
            });
    
            const rawSheetName = `‡∏™‡∏£‡∏∏‡∏õ ‡∏°.${summaryClassName.slice(1,2)}/${summaryClassName.slice(2)}`;
            const sheetName = makeSafeSheetName(rawSheetName);
            ws = XLSX.utils.json_to_sheet(data);
            XLSX.utils.book_append_sheet(wb, ws, sheetName);
          }
          break;
        }

    case 'shop1':
    case 'shop2':
    case 'shop3':
      const shopNum = view.replace('shop', '');
      const shopFilteredData = todayData.filter(d => d.shop === `‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ${shopNum}`)
        .map((d, i) => ({
          ‡∏•‡∏≥‡∏î‡∏±‡∏ö: i + 1,
          ‡∏ä‡∏∑‡πà‡∏≠: d.name,
          ID: d.id,
          ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤: d.shop,
          ‡πÄ‡∏ß‡∏•‡∏≤: d.time
        }));
      if (shopFilteredData.length > 0) {
        ws = XLSX.utils.json_to_sheet(shopFilteredData);
        XLSX.utils.book_append_sheet(wb, ws, `‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ${shopNum}`);
      }
      break;

    case 'summary':
      for (let i = 1; i <= 6; i++) {
        for (let j = 1; j <= 12; j++) {
          const className = `m${i}${j}`;
          if (classData[className]) {
            let combinedHistoricalDataForClass = [];
            for (const dateKey in historicalData) {
              const dataForDate = historicalData[dateKey]
                .filter(d => d.class === className)
                .map(d => ({ ...d, dateRecorded: d.dateRecorded || dateKey }));
              combinedHistoricalDataForClass = combinedHistoricalDataForClass.concat(dataForDate);
            }

            const data = classData[className].map((d, idx) => {
              let found = todayData.find(t => t.id === d.id);
              let use = '‚ùå', shop = '-', time = '-', dateRecorded = '-';

              if (found) {
                use = '‚úîÔ∏è';
                shop = found.shop;
                time = found.time;
                dateRecorded = formatDate(new Date());
              } else {
                const foundInHistory = combinedHistoricalDataForClass.find(t => t.id === d.id);
                if (foundInHistory) {
                  use = '‚úîÔ∏è';
                  shop = foundInHistory.shop;
                  time = foundInHistory.time;
                  dateRecorded = foundInHistory.dateRecorded;
                }
              }

              return {
                ‡∏•‡∏≥‡∏î‡∏±‡∏ö: idx + 1,
                ‡∏ä‡∏∑‡πà‡∏≠: d.name,
                ID: d.id,
                ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ: use,
                ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤: shop,
                ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: time,
                ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: dateRecorded
              };
            });

            const rawSheetName = `‡∏°.${i}/${j}`;
            const sheetName = makeSafeSheetName(rawSheetName);
            const ws = XLSX.utils.json_to_sheet(data);
            XLSX.utils.book_append_sheet(wb, ws, sheetName);
          }
        }
      }
      break;

    case 'summaryOneSheet':
      let allSummaryData = [];
      for (let i = 1; i <= 6; i++) {
        for (let j = 1; j <= 12; j++) {
          const className = `m${i}${j}`;
          if (classData[className]) {
            const classLabel = `‡∏°.${i}/${j}`;
            let combinedHistoricalDataForClass = [];
            for (const dateKey in historicalData) {
              const dataForDate = historicalData[dateKey]
                .filter(d => d.class === className)
                .map(d => ({ ...d, dateRecorded: d.dateRecorded || dateKey }));
              combinedHistoricalDataForClass = combinedHistoricalDataForClass.concat(dataForDate);
            }

            classData[className].forEach((d, idx) => {
              let found = todayData.find(t => t.id === d.id);
              let use = '‚ùå', shop = '-', time = '-', dateRecorded = '-';

              if (found) {
                use = '‚úîÔ∏è';
                shop = found.shop;
                time = found.time;
                dateRecorded = formatDate(new Date());
              } else {
                const foundInHistory = combinedHistoricalDataForClass.find(t => t.id === d.id);
                if (foundInHistory) {
                  use = '‚úîÔ∏è';
                  shop = foundInHistory.shop;
                  time = foundInHistory.time;
                  dateRecorded = foundInHistory.dateRecorded;
                }
              }

              allSummaryData.push({
                ‡∏•‡∏≥‡∏î‡∏±‡∏ö: idx + 1,
                ‡∏ä‡∏±‡πâ‡∏ô: classLabel,
                ‡∏ä‡∏∑‡πà‡∏≠: d.name,
                ID: d.id,
                ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ: use,
                ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤: shop,
                ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: time,
                ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: dateRecorded
              });
            });
          }
        }
      }
      if (allSummaryData.length > 0) {
        ws = XLSX.utils.json_to_sheet(allSummaryData);
        XLSX.utils.book_append_sheet(wb, ws, makeSafeSheetName('‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î'));
      }
      break;
  }

  if (wb.SheetNames.length > 0) {
    XLSX.writeFile(wb, `${view}.xlsx`);
  } else {
    alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏ô‡∏µ‡πâ');
  }
}

//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á
//‡∏°‡∏±‡∏ô‡∏î‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏á

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π Dropdown ‡∏ó‡∏µ‡πà‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô
function toggleMenu(role) {
  const menuId = role === 'admin' ? 'adminMenuDropdown' : 'shopMenuDropdown';
  const menu = document.getElementById(menuId);
  // ‡πÉ‡∏ä‡πâ querySelector ‡∏ó‡∏µ‡πà‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô
  const button = document.querySelector(`.${role}-menu-btn`);
  const icon = button ? button.querySelector('.menu-icon') : null; // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ button ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô

  if (!menu || !button || !icon) { // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö null
      console.error(`Menu elements not found for role: ${role}`);
      return;
  }

  if (menu.classList.contains('show')) {
    menu.style.opacity = '0';
    menu.style.transform = 'translateY(-10px)';
    button.classList.remove('toggle');
    icon.textContent = "‚ò∞";
    setTimeout(() => {
      menu.classList.remove('show');
      menu.style.visibility = 'hidden';
      menu.style.pointerEvents = 'none';
    }, 300);
  } else {
    menu.classList.add('show');
    menu.style.visibility = 'visible';
    menu.style.opacity = '1';
    menu.style.transform = 'translateY(0)';
    menu.style.pointerEvents = 'auto';
    button.classList.add('toggle');
    icon.textContent = "‚úñ";
  }
}

document.addEventListener('click', function(event) {
  const adminMenuDropdown = document.getElementById('adminMenuDropdown');
  const shopMenuDropdown = document.getElementById('shopMenuDropdown');
  
  // ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó
  const adminMenuBtn = document.querySelector('.admin-menu-btn'); 
  const shopMenuBtn = document.querySelector('.shop-menu-btn');

  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Admin Menu
  if (adminMenuDropdown && adminMenuDropdown.classList.contains('show')) {
    if (adminMenuBtn && !adminMenuBtn.contains(event.target) && !adminMenuDropdown.contains(event.target)) {
      toggleMenu('admin');
    }
  }
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Shop Menu
  if (shopMenuDropdown && shopMenuDropdown.classList.contains('show')) {
    if (shopMenuBtn && !shopMenuBtn.contains(event.target) && !shopMenuDropdown.contains(event.target)) {
      toggleMenu('shop');
    }
  }
});


// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å "‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô"
function toggleMainMenu() {
  const mainSubmenu = document.getElementById('mainSubmenu');
  const mainIcon = document.getElementById('mainMenuIcon');
  if (mainSubmenu.style.display === "block") {
    mainSubmenu.style.display = "none";
    mainIcon.textContent = "‚ñº";
  } else {
    mainSubmenu.style.display = "block";
    mainIcon.textContent = "‚ñ≤";
  }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏¢‡πà‡∏≠‡∏¢‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡∏±‡πâ‡∏ô (‡∏°.1-‡∏°.6)
function toggleClassSubmenu(id) {
  const submenu = document.getElementById(id);
  const icon = document.getElementById(id + "Icon");
  if (submenu.style.display === "block") {
    submenu.style.display = "none";
    icon.textContent = "‚ñº";
  } else {
    submenu.style.display = "block";
    icon.textContent = "‚ñ≤";
  }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏¢‡πà‡∏≠‡∏¢ "‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤"
function toggleShopSubmenu() {
  const shopSubmenu = document.getElementById('shopSubmenu');
  const shopIcon = document.getElementById('shopMenuIcon');
  if (shopSubmenu.style.display === "block") {
    shopSubmenu.style.display = "none";
    shopIcon.textContent = "‚ñº";
  } else {
    shopSubmenu.style.display = "block";
    shopIcon.textContent = "‚ñ≤";
  }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏¢‡πà‡∏≠‡∏¢ "‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á"
function toggleSummarySubmenu() {
  const summarySubmenu = document.getElementById('summarySubmenu');
  const summaryIcon = document.getElementById('summaryMenuIcon');
  if (summarySubmenu.style.display === "block") {
    summarySubmenu.style.display = "none";
    summaryIcon.textContent = "‚ñº";
  } else {
    summarySubmenu.style.display = "block";
    summaryIcon.textContent = "‚ñ≤";
  }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏¢‡πà‡∏≠‡∏¢‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡∏±‡πâ‡∏ô‡πÉ‡∏ô "‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á"
function toggleSummaryClassSubmenu(id) {
  const submenu = document.getElementById(id);
  const icon = document.getElementById(id + "Icon");
  if (submenu.style.display === "block") {
    submenu.style.display = "none";
    icon.textContent = "‚ñº";
  } else {
    submenu.style.display = "block";
    icon.textContent = "‚ñ≤";
  }
}

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö page switching)
function showPage(pageId) {
const pages = document.querySelectorAll('.page');
pages.forEach(page => {
    if (page.id === pageId) {
        page.classList.add('active');
    } else {
        page.classList.remove('active');
    }
});
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
// ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
function hideAllMenusAndButtons() {
// ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π admin/user ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÉ‡∏´‡πâ‡∏ã‡πà‡∏≠‡∏ô
const adminMenuBtn = document.querySelector('.admin-menu-btn');
const userMenuBtn = document.querySelector('.user-menu-btn');
if (adminMenuBtn) adminMenuBtn.style.display = 'none';
if (userMenuBtn) userMenuBtn.style.display = 'none';

// ‡∏ã‡πà‡∏≠‡∏ô sidebar ‡∏ñ‡πâ‡∏≤‡∏°‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà
const sidebar = document.getElementById('sidebar');
if (sidebar) sidebar.classList.remove('active');
const mainContent = document.getElementById('contentArea');
if (mainContent) mainContent.classList.remove('shifted');

// ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô sidebar ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
document.querySelectorAll('#admin-main-menu, #shop-main-menu, #user-main-menu').forEach(menu => {
    if (menu) menu.style.display = 'none';
});
// ‡∏ã‡πà‡∏≠‡∏ô submenu ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
document.querySelectorAll('.submenu').forEach(submenu => {
    if (submenu) submenu.style.display = 'none';
});
// ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô toggle
document.querySelectorAll('.menu-toggle-icon').forEach(icon => {
    if (icon) icon.textContent = "‚ñº";
});
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Logout
function logout() {
console.log("User logged out.");
localStorage.removeItem('userRole'); // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Local Storage
showPage('login-page'); // ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Login
hideAllMenusAndButtons(); // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å Logout
}

// ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô logout ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å HTML (global)
window.logout = logout;

// **‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç**: ‡∏´‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (admin, user, shop) ‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô
// ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å login (‡πÄ‡∏ä‡πà‡∏ô showAdminElements, displayUserElements, displayShopElements)
// ‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏•‡∏∞ `hideAllMenusAndButtons()` ‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Logout
// ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏ô‡∏π‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó

// ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö Login ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó)
window.onload = function() {
const userRole = localStorage.getItem('userRole');
if (!userRole) { // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤ login
    showPage('login-page');
    hideAllMenusAndButtons();
} else {
    // ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß (‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏¢ Login ‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ)
    // ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ï‡∏≤‡∏°‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ô‡∏±‡πâ‡∏ô‡πÜ ‡∏î‡πâ‡∏ß‡∏¢
    // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:
     if (userRole === 'admin') {
        showPage('main-app-page');
       showAdminElements();
     } else if (userRole === 'user') {
         showPage('use-page');
         displayUserElements();
     } else if (userRole === 'shop') {
         showPage('use-page');
         displayShopElements();
     }
    // ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÄ‡∏ô‡πâ‡∏ô‡πÅ‡∏Ñ‡πà‡∏õ‡∏∏‡πà‡∏° logout ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡πá‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ
}
};
// Function to toggle the visibility of the user dropdown menu (with logout button)
function toggleUserMenu() {
const dropdownMenu = document.getElementById('user-dropdown-menu');
// Ensure the dropdownMenu element exists before attempting to toggle its class
if (dropdownMenu) {
    dropdownMenu.classList.toggle('show');
}
}

// ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô logout() ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
function logout() {
console.log("User logged out.");
localStorage.removeItem('userRole'); // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Local Storage
showPage('login-page'); // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Login

// *** ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ: ‡∏ã‡πà‡∏≠‡∏ô dropdown ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏°‡∏∑‡πà‡∏≠ Logout ***
const userDropdownMenu = document.getElementById('user-dropdown-menu');
if (userDropdownMenu) {
    userDropdownMenu.classList.remove('show');
}

// *** ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢ ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ Sidebar ‡πÅ‡∏•‡∏∞ Content Area ‡∏ñ‡∏π‡∏Å‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏°‡∏∑‡πà‡∏≠ Logout ***
document.getElementById('sidebar')?.classList.remove('active');
document.getElementById('contentArea')?.classList.remove('shifted');
}





// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (todayData ‡πÅ‡∏•‡∏∞ historicalData) ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á
function clearAllDataManually() {
    if (currentUserRole !== 'admin') {
        alert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ');
        return;
    }

    if (confirm('‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡∏ó‡∏±‡πâ‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ')) {
        todayData = []; // ‡∏•‡πâ‡∏≤‡∏á todayData
        historicalData = {}; // ‡∏•‡πâ‡∏≤‡∏á historicalData
        localStorage.setItem('todayData', JSON.stringify(todayData)); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
        localStorage.setItem('historicalData', JSON.stringify(historicalData)); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á

        console.log('All data (todayData and historicalData) has been manually cleared by admin.');
        alert('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ñ‡∏π‡∏Å‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        renderTodayTable(); // ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤
        for (const className in classData) {
            updateClassTable(className); // ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏à‡∏∞‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤
            updateClassTableForSummary(className); // ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πâ‡∏ô‡∏à‡∏∞‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤
        }
        updateSummaryAllView(); // ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤

        // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ñ‡πâ‡∏≤ Admin ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏π‡∏≠‡∏¢‡∏π‡πà)
        // (‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ)
        if (document.getElementById('view-shop1-admin').style.display === 'block') updateShopTable(1, 'admin');
        if (document.getElementById('view-shop2-admin').style.display === 'block') updateShopTable(2, 'admin');
        if (document.getElementById('view-shop3-admin').style.display === 'block') updateShopTable(3, 'admin');

        // ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏î‡∏£‡∏≠‡∏õ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏î‡∏•‡πâ‡∏≤‡∏á
        const userDropdownMenu = document.getElementById('user-dropdown-menu');
        if (userDropdownMenu) {
            userDropdownMenu.classList.remove('show');
        }
    }
}

function getLast7DaysData() {
  const historicalData = JSON.parse(localStorage.getItem("historicalData")) || {};
  const sortedDates = Object.keys(historicalData).sort((a, b) => new Date(b) - new Date(a));
  const last7Dates = sortedDates.slice(0, 7);

  let combined = [];
  last7Dates.forEach(date => {
    const daily = historicalData[date];
    daily.forEach(entry => {
      combined.push({...entry, date});
    });
  });

  return combined;
}


// ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô HTML
window.switchView = switchView;
window.handleUseSubmit = handleUseSubmit;
window.downloadExcel = downloadExcel;
window.toggleMenu = toggleMenu;
window.logout = logout;
window.toggleMainMenu = toggleMainMenu;
window.toggleClassSubmenu = toggleClassSubmenu;
window.showShopAdminTable = showShopAdminTable;
window.toggleShopSubmenu = toggleShopSubmenu;
window.displayShopPageForShopUser = displayShopPageForShopUser;
window.toggleSummarySubmenu = toggleSummarySubmenu;
window.toggleSummaryClassSubmenu = toggleSummaryClassSubmenu;
window.toggleUserMenu = toggleUserMenu;
window.clearAllDataManually = clearAllDataManually;